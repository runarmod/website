var kart,x,y,inputBredde,inputHoyde,bombe,storrelsePerRute,breddeGameSection,forsteKlikk,inputBomber,flaggPlassert,feilFlaggPlassering,gamesection,antallBomberIgjen,startTid,totalTid,tapt,resultat,intervall,fontSizeEmoji;function visCustom(){document.getElementById("customSettings").style.visibility="visible"}function skjulCustom(){document.getElementById("customSettings").style.visibility="hidden"}function startSpill(){forsteKlikk=!0,tapt=!1,clearInterval(intervall),document.getElementById("tid").innerHTML="Tid: ",resultat.innerHTML="";var e=document.querySelector('input[name="gamemode"]:checked').value;if("custom"==e?((inputBredde=Number(document.getElementById("bredde").value))>50?inputBredde=50:inputBredde<4&&(inputBredde=4),(inputHoyde=Number(document.getElementById("hoyde").value))>30?inputHoyde=30:inputHoyde<4&&(inputHoyde=4),(inputBomber=Number(document.getElementById("bomber").value))>300?inputBomber=300:inputBomber<1&&(inputBomber=1)):"beginner"==e?(inputBredde=9,inputHoyde=9,inputBomber=10):"intermediate"==e?(inputBredde=16,inputHoyde=16,inputBomber=40):"expert"==e&&(inputBredde=30,inputHoyde=16,inputBomber=99),inputBomber>=inputBredde*inputHoyde)return alert("Det er flere bomber enn ruter");createMap(inputBredde,inputHoyde,inputBomber),bomberIgjen(),gamesection.style.pointerEvents="auto"}function createMap(e,t,n){gamesection.innerHTML="",kart=new Array(t);for(var o=0;o<t;o++){kart[o]=new Array(e);for(var r=0;r<e;r++)kart[o][r]=0}for(o=0;o<n;o++){for(randomPos();kart[y][x]==bombe;)randomPos();kart[y][x]=bombe}for(o=0;o<t;o++)for(r=0;r<e;r++)kart[o][r]==bombe&&(o>0&&(kart[o-1][r]!=bombe&&kart[o-1][r]++,r<e-1&&kart[o-1][r+1]!=bombe&&kart[o-1][r+1]++,r>0&&kart[o-1][r-1]!=bombe&&kart[o-1][r-1]++),r<e-1&&kart[o][r+1]!=bombe&&kart[o][r+1]++,r>0&&kart[o][r-1]!=bombe&&kart[o][r-1]++,o<t-1&&(kart[o+1][r]!=bombe&&kart[o+1][r]++,r<e-1&&kart[o+1][r+1]!=bombe&&kart[o+1][r+1]++,r>0&&kart[o+1][r-1]!=bombe&&kart[o+1][r-1]++));storrelsePerRute=Math.floor(breddeGameSection/inputBredde)-3,gamesection.style.width=storrelsePerRute*e,fontSizeEmoji=3*storrelsePerRute/4;for(o=0;o<t;o++){var i=document.createElement("div");i.id="y"+o,gamesection.appendChild(i);for(r=0;r<e;r++){var s=document.createElement("span");s.style.height=storrelsePerRute+"px",s.style.width=storrelsePerRute+"px",s.className.includes("opnet")?s.style.fontSize=fontSizeEmoji+"px":s.style.fontSize=storrelsePerRute+"px",s.classList.add("ikkeOpnet"),s.id=`y${o}x${r}`,document.getElementById("y"+o).appendChild(s)}}eventListener()}function eventListener(){for(var e=0;e<inputHoyde;e++)for(var t=0;t<inputBredde;t++)!function(){var n=document.getElementById(`y${e}x${t}`);n.addEventListener("mousedown",function(e){if(forsteKlikk&&(startTid=Date.now(),intervall=setInterval(function(){document.getElementById("tid").innerHTML=`Tid: ${(Date.now()-startTid)/1e3}s`},1)),2==e.button)forsteKlikk=!1,n.classList.contains("flagged")?(n.classList.remove("flagged"),n.classList.add("ikkeOpnet"),n.style.fontSize=storrelsePerRute+"px",n.innerHTML=""):n.classList.contains("ikkeOpnet")&&(n.classList.remove("ikkeOpnet"),n.classList.add("flagged"),n.style.fontSize=fontSizeEmoji+"px",n.innerHTML=flagg),bomberIgjen();else if(0==e.button&&n.classList.contains("ikkeOpnet")){var t=finnYPosisjonFraId(n),o=finnXPosisjonFraId(n);forsteKlikk&&0!=kart[t][o]?(createMap(inputBredde,inputHoyde,inputBomber),forsokASnuForsteSomNull(t,o)):snu(t,o)}})}()}function randomPos(){return x=Math.floor(Math.random()*inputBredde),y=Math.floor(Math.random()*inputHoyde)}function finnYPosisjonFraId(e){for(var t="",n=1;n<e.id.indexOf("x")-e.id.indexOf("y");n++)t+=e.id[n].toString();return t}function finnXPosisjonFraId(e){for(var t="",n=e.id.indexOf("x")+1;n<e.id.length;n++)t+=e.id[n].toString();return t}function snu(e,t){forsteKlikk=!1,element=document.getElementById(`y${e}x${t}`),element.classList.remove("ikkeOpnet"),element.classList.add("opnet"),element.classList.add(kart[e][t]),element.classList.contains(bombe)&&(gameOverTap(element),element.style.fontSize=fontSizeEmoji+"px"),element.innerHTML=kart[e][t],loopGjennomKart()}function forsokASnuForsteSomNull(e,t){for(;0!=kart[e][t];)createMap(inputBredde,inputHoyde,inputBomber);forsteKlikk=!1,snu(e,t)}function loopGjennomKart(){for(var e=0;e<inputHoyde;e++)for(var t=0;t<inputBredde;t++)document.getElementById(`y${e}x${t}`).classList.contains("0")&&(document.getElementById(`y${e}x${t}`).innerHTML="",e>0&&(document.getElementById(`y${e-1}x${t}`).classList.contains("ikkeOpnet")&&snu(e-1,t),t>0&&document.getElementById(`y${e-1}x${t-1}`).classList.contains("ikkeOpnet")&&snu(e-1,t-1),t<inputBredde-1&&document.getElementById(`y${e-1}x${t+1}`).classList.contains("ikkeOpnet")&&snu(e-1,t+1)),t<inputBredde-1&&document.getElementById(`y${e}x${t+1}`).classList.contains("ikkeOpnet")&&snu(e,t+1),t>0&&document.getElementById(`y${e}x${t-1}`).classList.contains("ikkeOpnet")&&snu(e,t-1),e<inputHoyde-1&&(document.getElementById(`y${e+1}x${t}`).classList.contains("ikkeOpnet")&&snu(e+1,t),t<inputBredde-1&&document.getElementById(`y${e+1}x${t+1}`).classList.contains("ikkeOpnet")&&snu(e+1,t+1),t>0&&document.getElementById(`y${e+1}x${t-1}`).classList.contains("ikkeOpnet")&&snu(e+1,t-1)));var n=document.getElementsByClassName("opnet");for(e=0;e<n.length;e++)stilOpnet(n[e]);bomberIgjen(),document.getElementsByClassName("ikkeOpnet").length!=antallBomberIgjen||tapt||gameOverSeier()}function bomberIgjen(){flaggPlassert=document.getElementsByClassName("flagged").length,antallBomberIgjen=inputBomber-flaggPlassert,document.getElementById("bomberIgjen").innerHTML=`Bomber igjen: ${antallBomberIgjen}`}function stilOpnet(e){e.classList.contains("1")?e.style.color="red":e.classList.contains("2")?e.style.color="blue":e.classList.contains("3")?e.style.color="green":e.classList.contains("4")?e.style.color="purple":e.classList.contains("5")?e.style.color="magenta":e.classList.contains("6")?e.style.color="#cdff7d":e.classList.contains("7")?e.style.color="#cb87ff":e.classList.contains("8")&&(e.style.color="#ffdfba")}function gameOverTap(e){tapt=!0,e.style.backgroundColor="red",gamesection.style.pointerEvents="none",snuBomber(),resultat.innerHTML="Du tapte!",clearInterval(intervall)}function snuBomber(){for(var e=0;e<inputHoyde;e++)for(var t=0;t<inputBredde;t++){var n=document.getElementById(`y${e}x${t}`);kart[e][t]==bombe&&n.innerHTML!=flagg?(n.classList.add(kart[e][t]),n.style.fontSize=fontSizeEmoji+"px",n.innerHTML=kart[e][t],n.classList.add("opnet"),n.classList.remove("ikkeOpnet")):kart[e][t]!=bombe&&n.innerHTML==flagg&&(n.classList.add(kart[e][t]),n.style.fontSize=fontSizeEmoji+"px",n.innerHTML=feilFlaggPlassering,n.classList.add("opnet"),n.classList.remove("ikkeOpnet"))}}function gameOverSeier(){gamesection.style.pointerEvents="none",totalTid=(Date.now()-startTid)/1e3,clearInterval(intervall),document.getElementById("tid").innerHTML=`Tid: ${totalTid}s`,resultat.innerHTML=`Du vant med tiden ${totalTid} sekunder!`}resultat=document.getElementById("resultat"),gamesection=document.getElementById("gamesection"),breddeGameSection=700,document.getElementById("wrapper").style.maxWidth=breddeGameSection+"px",flagg="🚩",bombe="💣",feilFlaggPlassering="❌",forsteKlikk=!0,document.getElementsByTagName("body")[0].onresize=function(){var e=document.getElementsByTagName("span");if(innerWidth<breddeGameSection){storrelsePerRute=Math.floor(innerWidth/inputBredde)-3,fontSizeEmoji=3*storrelsePerRute/4;for(var t=0;t<e.length;t++)e[t].style.height=storrelsePerRute+"px",e[t].style.width=storrelsePerRute+"px",0==e[t].className.includes("opnet")?e[t].style.fontSize=storrelsePerRute+"px":e[t].style.fontSize=fontSizeEmoji+"px"}},gamesection.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keypress",function(e){"Enter"!==e.key&&"KeyR"!=e.code||startSpill()});
